{% extends "base.html" %}
{% block content %}
<div style="width:100%;max-width:720px;margin:0 auto;padding:16px;">
  <h2 style="font-weight:700;margin-bottom:12px;">Contas (admins)</h2>
  <table style="width:100%;border-collapse:collapse;background:#fff;border:1px solid #e5e7eb;border-radius:12px;overflow:hidden;">
    <thead>
      <tr style="background:#f9fafb;color:#374151;text-align:left;">
        <th style="padding:10px;border-bottom:1px solid #e5e7eb;">Empresa</th>
        <th style="padding:10px;border-bottom:1px solid #e5e7eb;">Plano</th>
        <th style="padding:10px;border-bottom:1px solid #e5e7eb;">Status</th>
        <th style="padding:10px;border-bottom:1px solid #e5e7eb;">Trial até</th>
        <th style="padding:10px;border-bottom:1px solid #e5e7eb;">Próx. período</th>
        <th style="padding:10px;border-bottom:1px solid #e5e7eb;">Ações (Trial)</th>
        <th style="padding:10px;border-bottom:1px solid #e5e7eb;">Plano/Status</th>
      </tr>
    </thead>
    <tbody>
      {% for u in users %}
      <tr>
        <td style="padding:10px;border-bottom:1px solid #f1f5f9;">{{ u.company_name }}</td>
        <td style="padding:10px;border-bottom:1px solid #f1f5f9;">{{ (u.plan or 'free')|upper }}</td>
        <td style="padding:10px;border-bottom:1px solid #f1f5f9;">{{ u.subscription_status or 'n/a' }}</td>
        <td style="padding:10px;border-bottom:1px solid #f1f5f9;">{{ u.trial_ends_at.strftime('%d/%m/%Y') if u.trial_ends_at else '-' }}</td>
        <td style="padding:10px;border-bottom:1px solid #f1f5f9;">{{ u.current_period_end_at.strftime('%d/%m/%Y') if u.current_period_end_at else '-' }}</td>
        <td style="padding:10px;border-bottom:1px solid #f1f5f9;">
          <div style="display:flex;flex-wrap:wrap;gap:6px;align-items:center;">
            {% if not u.trial_started_at %}
            <form method="post" action="{{ url_for('main.platform_account_trial_start', user_id=u.id) }}">
              <button type="submit" style="background:#232323;color:#fff;border:none;border-radius:8px;padding:6px 10px;">Iniciar 30d</button>
            </form>
            {% else %}
            <form method="post" action="{{ url_for('main.platform_account_trial_expire', user_id=u.id) }}">
              <button type="submit" style="background:#fff;color:#b91c1c;border:1px solid #fecaca;border-radius:8px;padding:6px 10px;">Expirar agora</button>
            </form>
            <form method="post" action="{{ url_for('main.platform_account_trial_extend', user_id=u.id) }}" style="display:inline-flex;gap:6px;align-items:center;">
              <input type="number" name="days" value="7" min="1" max="60" style="width:60px;padding:6px;border:1px solid #e5e7eb;border-radius:8px;">
              <button type="submit" style="background:#fff;color:#065f46;border:1px solid #a7f3d0;border-radius:8px;padding:6px 10px;">+ dias</button>
            </form>
            {% endif %}
            <form method="post" action="{{ url_for('main.platform_account_trial_reset', user_id=u.id) }}">
              <button type="submit" style="background:#fff;color:#374151;border:1px solid #e5e7eb;border-radius:8px;padding:6px 10px;">Resetar trial</button>
            </form>
            <form method="post" action="{{ url_for('main.platform_account_trial_grant', user_id=u.id) }}" style="display:inline-flex;gap:6px;align-items:center;">
              <input type="number" name="days" value="30" min="1" max="90" style="width:60px;padding:6px;border:1px solid #e5e7eb;border-radius:8px;">
              <button type="submit" style="background:#232323;color:#fff;border:none;border-radius:8px;padding:6px 10px;">Conceder trial</button>
            </form>
          </div>
        </td>
        <td style="padding:10px;border-bottom:1px solid #f1f5f9;">
          <div style="display:flex;flex-direction:column;gap:8px;">
            <form method="post" action="{{ url_for('main.platform_account_plan_update', user_id=u.id) }}" style="display:flex;gap:6px;align-items:center;">
              <select name="plan" style="padding:6px;border:1px solid #e5e7eb;border-radius:8px;">
                <option value="free" {% if (u.plan or 'free')=='free' %}selected{% endif %}>FREE</option>
                <option value="basic" {% if (u.plan or '').lower()=='basic' %}selected{% endif %}>BASIC</option>
                <option value="pro" {% if (u.plan or '').lower()=='pro' %}selected{% endif %}>PRO</option>
                <option value="advanced" {% if (u.plan or '').lower() in ['advanced','avancado'] %}selected{% endif %}>ADVANCED</option>
              </select>
              <button type="submit" style="background:#fff;color:#374151;border:1px solid #e5e7eb;border-radius:8px;padding:6px 10px;">Atualizar plano</button>
            </form>
            <form method="post" action="{{ url_for('main.platform_account_activate_manual', user_id=u.id) }}" style="display:flex;gap:6px;align-items:center;flex-wrap:wrap;">
              <select name="plan" style="padding:6px;border:1px solid #e5e7eb;border-radius:8px;">
                <option value="basic">BASIC</option>
                <option value="pro">PRO</option>
                <option value="advanced">ADVANCED</option>
              </select>
              <input type="number" name="days" value="30" min="1" max="365" style="width:80px;padding:6px;border:1px solid #e5e7eb;border-radius:8px;">
              <button type="submit" style="background:#065f46;color:#fff;border:none;border-radius:8px;padding:6px 10px;">Ativar manual</button>
            </form>
            <form method="post" action="{{ url_for('main.platform_account_status_set', user_id=u.id) }}" style="display:flex;gap:6px;align-items:center;">
              <select name="status" style="padding:6px;border:1px solid #e5e7eb;border-radius:8px;">
                <option value="active" {% if (u.subscription_status or '')=='active' %}selected{% endif %}>ACTIVE</option>
                <option value="trial" {% if (u.subscription_status or '')=='trial' %}selected{% endif %}>TRIAL</option>
                <option value="canceled" {% if (u.subscription_status or '')=='canceled' %}selected{% endif %}>CANCELED</option>
                <option value="expired" {% if (u.subscription_status or '')=='expired' %}selected{% endif %}>EXPIRED</option>
                <option value="none" {% if not u.subscription_status %}selected{% endif %}>NONE</option>
              </select>
              <button type="submit" style="background:#fff;color:#374151;border:1px solid #e5e7eb;border-radius:8px;padding:6px 10px;">Definir status</button>
            </form>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
